<p id="notice"><%= notice %></p>

<%= render 'form', deal: @deal %>


<% unless @deal.paid %>
  <% if @deal.stylist_agree == true && @deal.scrub_agree == true && current_user.id == @deal.buyer %>

  <%= form_tag charges_path do %>
    <article>
      <% if flash[:error].present? %>
        <div id="error_explanation">
          <p><%= flash[:error] %></p>
        </div>
      <% end %>
      <label class="amount">
        <span>Amount: $<%= @deal.offer.price %></span>
      </label>
    </article>

    <%= hidden_field_tag :deal_id, @deal.id %>
  
    <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
            data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
            data-description="<%= @deal.profile.username %>'s Offer'"
            data-amount="<%= @deal.offer.price * 100 %>"
            data-locale="auto"></script>
    <% end %>
  <% end %>
<% end %>

<p>
  <strong>Stylist agreed to offer:</strong>
  <%= @deal.stylist_agree %>
</p>

<p>
  <strong>Scrub agreed to offer:</strong>
  <%= @deal.scrub_agree %>
</p>

<p>
  <strong>Offer paid:</strong>
  <% if @deal.paid %>
    <p>Yes</p>
  <% end %>
</p>

<p>
  <strong>Profile:</strong>
  <%= @deal.profile_id %>
</p>

<p>
  <strong>User:</strong>
  <%= @deal.user_id %>
</p>

<p>
  <strong>Offer:</strong>
  <%= @deal.offer_id %>
</p>



<%= link_to 'Edit', edit_deal_path(@deal) %> |
<%= link_to 'Back', deals_path %>


